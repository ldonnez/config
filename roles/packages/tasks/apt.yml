- name: Ensure backports repository is enabled
  when: ansible_os_family == "Debian"
  become: true
  ansible.builtin.blockinfile:
    path: /etc/apt/sources.list
    block: |
      # backports
      deb http://deb.debian.org/debian {{ ansible_distribution_release }}-backports main contrib non-free-firmware non-free

- name: Install packages with apt
  ansible.builtin.apt:
    name: "{{ packages }}"
    state: present
  become: true
  tags:
    - install

- name: Update and upgrade installed apt packages
  become: true
  ansible.builtin.apt:
    update_cache: true
    upgrade: true
  tags:
    - update
